{"version":3,"sources":["assets\\Script\\Managers\\CollisionManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Ball from '../Roles/Ball'\r\nimport Player from '../Roles/Player'\r\nimport GameManager from './GameManager'\r\nimport RecordApi from '../Api/RecordApi';\r\nimport Utils from '../Utils/Utils';\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\nenum BoxColliderType {\r\n    Ball = 0,\r\n    Player = 1,\r\n    Wall = 2\r\n}\r\n\r\n@ccclass\r\nexport default class CollisionManager extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    gameManager: cc.Node = null;\r\n    \r\n    onEnable() {\r\n        cc.director.getCollisionManager().enabled = true;\r\n    }\r\n\r\n    onDisable() {\r\n        cc.director.getCollisionManager().enabled = false;\r\n    }\r\n\r\n    onCollisionEnter(other: cc.BoxCollider, self: cc.BoxCollider) {\r\n        if (self.tag == BoxColliderType.Ball && other.tag == BoxColliderType.Ball) {\r\n            let s = self.node.getComponent(Ball);\r\n            let o = other.node.getComponent(Ball);\r\n            s.velocity = cc.v2(o.velocity.y, o.velocity.x)\r\n        } else if(self.tag == BoxColliderType.Ball && other.tag == BoxColliderType.Player) {\r\n            \r\n        } else if(self.tag == BoxColliderType.Player && other.tag == BoxColliderType.Ball) {\r\n            \r\n            let s = self.node.getComponent(Player);\r\n            let o = other.node.getComponent(Ball);\r\n\r\n            let similar = s.colorType == o.colorType;\r\n            if (!similar && s.mass - o.mass <= 0) {\r\n                // 更新用户的记录\r\n                let uid = cc.sys.localStorage.getItem(\"uid\");\r\n                if (uid == undefined || uid == null || uid == \"\") uid = 0;\r\n                let maxSeconds = this.gameManager.getComponent(GameManager).maxSeconds;\r\n                RecordApi.GetByUId(uid, {\r\n                    success: (record) => {\r\n                        let w: number = record.weight < s.maxMass ? s.maxMass : record.weight;\r\n                        let t: number = record.maxTime < maxSeconds ? maxSeconds : record.maxTime;\r\n                        RecordApi.Update(record.id, uid, w, t, {\r\n                            success: (record) => {},\r\n                            fail: (err) => {\r\n                                Utils.ShowError(\"刷新记录失败\");\r\n                            }\r\n                        })\r\n                    },\r\n                    fail: (err) => {\r\n                        RecordApi.Add(uid, s.maxMass, maxSeconds, {\r\n                            success: (record) => {},\r\n                            fail: (err) => {\r\n                                Utils.ShowError(\"保存记录失败\");\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n                cc.director.loadScene(\"RankSence\", null);\r\n                return;\r\n            }\r\n            let newRadius = !similar ? s.raduis - o.raduis : s.raduis + o.raduis;\r\n            // 重新生成半径及颜色\r\n            s.calculateProperty(newRadius, o.colorType);\r\n            // 移除小球\r\n            let canvas = cc.find(\"Canvas\");\r\n            canvas.removeChild(o.node, true);\r\n            this.gameManager.getComponent(GameManager).ballNum--;\r\n        } else if(self.tag == BoxColliderType.Ball && other.tag == BoxColliderType.Wall) {\r\n            let s = self.node.getComponent(Ball);\r\n            s.velocity = cc.v2(-s.velocity.x, -s.velocity.y);\r\n        } else if(self.tag == BoxColliderType.Player && other.tag == BoxColliderType.Wall) {\r\n            // let s = self.node.getComponent(Player);\r\n            // let f = s.speedLimitFator;\r\n            // s.speedLimitFator = -2;\r\n            // setTimeout(() => {\r\n            //     s.speedLimitFator = f;\r\n            // }, 1000);\r\n        }\r\n    }\r\n}\r\n"]}