{"version":3,"sources":["assets\\Script\\Managers\\MenuCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UserApi from '../Api/UserApi';\r\nimport Utils from '../Utils/Utils';\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\ninterface Action {\r\n    Do(): void;\r\n}\r\n\r\n@ccclass\r\nexport default class MenuCtrl extends cc.Component {\r\n\r\n    saveUserInfo(username: string, avatarUrl: string, action?: Action) {\r\n        UserApi.GetByName(username, {\r\n            success: (user) => {\r\n                // console.log(\"success\");\r\n                // console.log(user);\r\n                cc.sys.localStorage.setItem(\"uid\", user.id);\r\n                cc.sys.localStorage.setItem(\"nickName\", user.name);\r\n                cc.sys.localStorage.setItem(\"avatarUrl\", user.avatarUrl);\r\n                if (action) action.Do();\r\n            },\r\n            fail: (err) => {\r\n                // console.log(\"error\");\r\n                // console.log(err);\r\n                // 失败时表示未找到用户，此时创建一个新用户\r\n                UserApi.Add(username, avatarUrl, {\r\n                    success: (user) => {\r\n                        // console.log(user.id);\r\n                        cc.sys.localStorage.setItem(\"uid\", user.id);\r\n                        cc.sys.localStorage.setItem(\"nickName\", user.name);\r\n                        cc.sys.localStorage.setItem(\"avatarUrl\", user.avatarUrl);\r\n                        if (action) action.Do();\r\n                    },\r\n                    fail: (err) => {\r\n                        Utils.ShowError(\"用户创建失败\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    startGame() {\r\n        let nickName: string = cc.sys.localStorage.getItem('nickName');\r\n        if (nickName == undefined || nickName == null || nickName == \"\") {\r\n            wx.getUserProfile({\r\n                desc: \"获取您的昵称及头像\",\r\n                success: (res) => {\r\n                    this.saveUserInfo(res.userInfo.nickName, res.userInfo.avatarUrl, {\r\n                        Do: () => {\r\n                            cc.director.loadScene(\"MainSence\", null);\r\n                        }\r\n                    });\r\n                },\r\n                fail: (e) => {\r\n                    Utils.ShowError(e.errMsg);\r\n                }\r\n            });\r\n        } else {\r\n            let avatarUrl: string = cc.sys.localStorage.getItem('avatarUrl');\r\n            this.saveUserInfo(nickName, avatarUrl, {\r\n                Do: () => {\r\n                    cc.director.loadScene(\"MainSence\", null);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    quitGame() {\r\n        cc.director.end();\r\n    }\r\n\r\n    shareGame() {\r\n        Utils.ShowInfo(\"正在努力开发中...\");\r\n    }\r\n\r\n    menuScene() {\r\n        cc.director.loadScene(\"MenuSence\", null);\r\n    }\r\n\r\n    showRank() {\r\n        cc.director.loadScene(\"RankSence\", null);\r\n    }\r\n   \r\n}\r\n"]}